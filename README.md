# Spark String Matching 

### Process :
    1) We need to find the all possible matches among ofac and uk data , we need to perform crossJoin to accomplish this , but it can be a costly performance issue which we do cartesian product of two dataframes , in order to reduce it we perform crossJoin on same "type" in both the dataframes and do a union on them,In the mentioned datasets we have "Entitiy" , "Individual" , "Aircraft" and "Vessel" types , we perform crossjoin on the similar types
    2) Once the data is joined we perform fuzzy match to find the similar strings , we use token_set_ratio
    3) We calculate the mean of all calculated ratios and filter out the data based on threshold (>45)

### Steps to run :
`pip install -r requirements.txt`

`spark-submit app.py --threshold=45 --ofac=data/ofac.jsonl.gz --uk=data/gbr.jsonl.gz --destination=data/output.csv`


## Sample Data
| |       |                  |                      |                      |            |                      |                      |               |              |              |                 |                      |                      |               |                      |                      |                 |                |                |                   |                      |                      |           |                      |                      |             |   |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------|------------------|----------------------|----------------------|------------|----------------------|----------------------|---------------|--------------|--------------|-----------------|----------------------|----------------------|---------------|----------------------|----------------------|-----------------|----------------|----------------|-------------------|----------------------|----------------------|-----------|----------------------|----------------------|-------------|---|
| ofac_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | uk_id | fuzzy_mean_score | us_name              | uk_name              | name_match | us_address           | uk_address           | address_match | us_countries | uk_countries | countries_match | us_aliases           | uk_aliases           | aliases_match | us_id_number         | uk_id_number         | id_number_match | us_nationality | uk_nationality | nationality_match | us_place_of_birth    | uk_place_of_birth    | pob_match | us_dob               | uk_dob               | dates_match | | |
| |       |                  |                      |                      |            |                      |                      |               |              |              |                 |                      |                      |               |                      |                      |                 |                |                |                   |                      |                      |           |                      |                      |             |   |
| 13095                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 12627 | 95               | Mochammad ACHWAN     | Mochammad ACHWAN     | 100        | Jalan Ir. H. Juan... | Jalan Ir. H. Juan... | 100           | Indonesia    | Indonesia    | 100             | Mochammad ACHWAN,... | Mochtar AKHWAN,Mo... | 71            | 3573010405480001     | 3573010405480001     | 100             | Indonesia      | Indonesian     | 94                | Tulungagung, Indo... | Tulungagung, Indo... | 100       | 04 May 1948,04 Ma... | 04/05/1948,04/05/... | 100         | | |
| 18620                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 13352 | 95               | Tuah FEBRIWANSYAH    | Tuah FEBRIWANSYAH    | 100        | Jalan Baru LUK, N... | Jalan Baru LUK, N... | 100           | Indonesia    | Indonesia    | 100             | Tuah FEBRIWANSYAH... | Tuah Febriwansyah... | 64            | 09.5004.180268.0074  | 09.5004.180268.0074  | 100             | Indonesia      | Indonesia      | 100               | Jakarta, Indonesia   | Jakarta, Indonesia   | 100       | 18 Feb 1968          | 18/02/1968           | 100         | | |
| 12922                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 12632 | 95               | Abdur REHMAN         | ABDUR REHMAN         | 100        | , , , Karachi,       | Karachi              | 100           | Pakistan     | Pakistan     | 100             | Abdur REHMAN,Abdu... | Abdul Rehman AL-S... | 72            | CV9157521,44103-5... | 44103-5251752-5,C... | 100             | Pakistan       | Pakistani      | 94                | Mirpur Khas, Paki... | Mirpur Khas, Paki... | 100       | 03 Oct 1965          | 03/10/1965           | 100         | | |
| 9357                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 8683  | 93               | Faycal BOUGHANEMI    | Faycal BOUGHANEMI    | 100        | viale Cambonino, ... | Viale Cambonino 5... | 100           | Italy        | Italy        | 100             | Faycal BOUGHANEMI    | Faysal AL-BUGHANI... | 56            | BGHFCL66R28Z352G     | BGHFCL66R28Z352G     | 100             | Tunisia        | Tunisian       | 93                | Tunis, Tunisia       | Tunis, Tunisia       | 100       | 28 Oct 1966          | 28/10/1966           | 100         | | |
| 7329                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 6894  | 93               | Mohamad Iqbal ABD... | Mohamad Iqbal ABD... | 100        | Jalan Nakula, Kom... | Jalan Nakula, Kom... | 93            | Indonesia    | Indonesia    | 100             | Mohamad Iqbal ABD... | Mohamad Iqbal A R... | 65            | 3603251708570001     | 3603251708570001     | 100             | Indonesia      | Indonesian     | 94                | Tirpas-Selong Vil... | (1) Tirpas-Selong... | 94        | 17 Aug 1957,17 Au... | 17/08/1958,17/08/... | 100         | | |


