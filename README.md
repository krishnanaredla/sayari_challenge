# Spark String Matching 

### Process :
    1) We need to find the all possible matches among ofac and uk data , we need to perform crossJoin to accomplish this , but it can be a costly performance issue which we do cartesian product of two dataframes , in order to reduce it we perform crossJoin on same "type" in both the dataframes and do a union on them,In the mentioned datasets we have "Entitiy" , "Individual" , "Aircraft" and "Vessel" types , we perform crossjoin on the similar types
    2) Once the data is joined we perform fuzzy match to find the similar strings , we use token_set_ratio
    3) We calculate the mean of all calculated ratios and filter out the data based on threshold (>45)

### Steps to run :
`pip install -r requirements.txt`

`spark-submit app.py --threshold=45 --ofac=data/ofac.jsonl.gz --uk=data/gbr.jsonl.gz --destination=data/output.csv`


### sample data:

| ofac_id | uk_id | fuzzy_mean_score | us_name              | uk_name                    | name_match | us_address                                          | uk_address                                          | address_match | us_countries            | uk_countries                          | countries_match | us_aliases                                               | uk_aliases                                                  | aliases_match | us_id_number             | uk_id_number             | id_number_match | us_nationality | uk_nationality         | nationality_match | us_place_of_birth      | uk_place_of_birth      | pob_match | us_dob                     | uk_dob                     | dates_match |
| ------- | ----- | ---------------- | --------------------| --------------------------| ---------- | ---------------------------------------------------- | ---------------------------------------------------- | ------------- | ----------------------- | -------------------------------------- | -------------- | --------------------------------------------------------- | ----------------------------------------------------------- | ------------- | ------------------------ | ------------------------ | --------------- | -------------- | ---------------------- | ------------------ | ---------------------- | ---------------------- | --------- | ------------------------- | ------------------------- | ----------- |
| 2676    | 7016  | 49               | Dr. Ayman AL ZAWA... | Aiman Muhammed Ra...       | 62         |                                                      |                                                      | 0             |                          |                                      | 0              | Dr. Ayman AL ZAWA...                                     | Abdul Qader Abdul...                                         | 31            | 19820215,1084010         | 1084010,19820215         | 100             |                | Egyptian               | 0                | Giza, Egypt            | Giza, Egypt            | 100       | 19 Jun 1951                | 19/06/1951                 | 100         |
| 6907    | 6899  | 47               | Thirwat Salah SHI... | Tharwat Salah SHI...      | 95         |                                                      |                                                      | 0             |                          |                                      | 0              | Thirwat Salah SHI...                                     | Tharwat Salah Shi...                                         | 84            |                            |                            | 0               |                | Egyptian               | 0                | Egypt                  | Egypt                  | 100       | 29 Jun 1960                | 29/06/1960                 | 100         |
| 6920    | 7015  | 46               | Ibrahim Salih Moh... | Ibrahim Salih Moh...      | 100        |                                                      |                                                      | 0             |                          |                                      | 0              |                                                           |                                                             | 0             |                            |                            | 0               | Saudi Arabia | Saudi Arabian Cit...   | 72               | Tarut, Saudi Arabia    | Tarut, Saudi Arabia    | 100       | 16 Oct 1966                | 16/10/1966                 | 100         |
| 6925    | 6925  | 56               | Ahmed Khalfan GHA... | Ahmed Khalfan GHA...      | 100        |                                                      |                                                      | 0             |                          | United States of ...                  | 0              | Ahmed Khalfan GHA...                                     | Abu Bakr AHMAD,Ab...                                         | 53            |                            |                            | 0               | Tanzania     | Tanzania              | 100             | Zanzibar, Tanzania     | Zanzibar, Tanzania     | 100       | 14 Mar 1974,13 Ap...       | 01/08/1970,13/04/...       | 100         |

